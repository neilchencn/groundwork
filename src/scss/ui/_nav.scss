// =============================================
//                Navigation
//          Last Updated:2013-8-21
// =============================================

$navigation-classes:  true !default;
$navigation-states:   "on" "active" !default;
$aria-selectors:      true !default;
$nav-color:           lighten(gray, 32.5%) !default;
$nav-text:            darken(gray, 15%) !default;
$nav-border-color:    lighten(gray, 27.5%) !default;;
$nav-active:          lighten(gray, 27.5%) !default;
$nav-active-text:     darken(gray, 12%) !default;
$border-thickness:    1px !default;
$border-style:        solid !default;
$border-color:        #dddddd !default;

%navigation {
  @extend %clear, %relative;
  background: $nav-color;
  color: $nav-text;
  border: $border-thickness $border-style $nav-border-color;
  @include rounded($default-radius);
}

%navigation-list {
  @extend %unstyled, %zero, %clear;
}

%navigation-list-item {
  @extend %block, %relative, %pull-left;
}

%navigation-link {
  @extend %inline-block, %align-center, %strong;
  background: $nav-color;
  color: $nav-text;
  cursor: pointer;
  padding: 0.25em 1em;
  text-decoration: none;
  cursor: pointer;
  line-height: 1.5;
  &:hover, &:focus {
    @extend %navigation-link-active;
  }
}

%hamburger-button {
  @extend %pull-right;
  display: none;
  background: none;
  color: $nav-active-text;
  border: 0;
}

%navigation-link-on, %navigation-link-active {
  background: $nav-active;
  color: $nav-active-text;
  text-decoration: none;
}

%navigation-link-disabled  { @include state(disabled,normal,desaturate($nav-color,20%)); }

%navigation-menu {
  display: none;
  position: absolute;
  z-index: 9;
  min-width: 100%;
  border: $border-thickness $border-style $nav-border-color;
  font-size: 0.9em;
  @include rounded(0 0 $default-radius $default-radius);
}

@for $i from 1 through length($modifier-name) {
  %navigation-#{nth($modifier-name, $i)},
  %navigation-menu-#{nth($modifier-name, $i)} {
    background-color: #{nth($modifier-code, $i)};
    color: #{nth($modifier-text, $i)};
    border-color: darken(nth($modifier-code, $i), 5%);
  }
  %navigation-link-#{nth($modifier-name, $i)} {
    background-color: #{nth($modifier-code, $i)};
    color: #{nth($modifier-text, $i)};
    border-color: darken(nth($modifier-code, $i), 5%);
    &.active, &:hover, &:focus {
      background: darken(nth($modifier-code, $i), 5%);
      border-color: darken(nth($modifier-code, $i), 10%);
    }
    &.disabled {
      @include state(disabled,normal,desaturate(nth($modifier-code, $i),20%));
    }
  }
}

@mixin hamburger-mode($filters: "") {
  .touch {
    .nav#{$filters} {
      &:before {
        float: left;
        display: inline-block;
        content: attr(title);
        padding: 0.25em 0.5em;
      }
      button {
        display: block;
      }
      > ul {
        display: none;
      }
      > ul.open {
        display: block;
      }
      li {
        float: none;
        display: block;
        ul {
          position: static;
        }
        li {
          text-indent: $gutter;
          li {
            text-indent: ($gutter * 2);
          }
        }
        &.menu {
          // &.on {
          //   > a {
          //     border-bottom: 0;
          //   }
          // }
          ul {
            border: 0;
            a {
              border-bottom: $border-thickness $border-style $nav-border-color;
            }
          }
          > a {
            &:after {
              float: none;
              content: "\f0d7";
            }
          }
          &.on {
            > a {
              &:after {
                content: "\f0d8";
              }
            }
          }
        }
      }
      a {
        display: block;
        text-align: left;
        border-bottom: $border-thickness $border-style $nav-border-color;
      }
      @for $i from 1 through length($modifier-name) {
        &.#{nth($modifier-name, $i)} {
          li ul a, li.menu ul a, a {
            border-top: 0;
            border-bottom: $border-thickness $border-style darken(nth($modifier-code, $i), 5%);
            @include rounded(0);
          }
        }
      }
    }
    > ul li:last-child {
      a {
        border-bottom: 0;
      }
    }
  }
}

@if $navigation-classes {
  .nav {
    @extend %navigation;

    button {
      @extend %hamburger-button;
    }

    // modifier colors
    @for $i from 1 through length($modifier-name) {
      &.#{nth($modifier-name, $i)} {
        @extend %navigation-#{nth($modifier-name, $i)};
        button {
          color: #{nth($modifier-text, $i)}
        }
        li.menu {
          ul {
            @extend %navigation-menu-#{nth($modifier-name, $i)};
            a {
              @extend %navigation-link-#{nth($modifier-name, $i)};
            }
          }
          &.on {
            > a {
              background: darken(nth($modifier-code, $i), 5%);
              border-color: darken(nth($modifier-code, $i), 10%);
              color: nth($modifier-text, $i)
            }
          }
        }
        a {
          @extend %navigation-link-#{nth($modifier-name, $i)};
        }
      }
    }

    ul {
      @extend %navigation-list;
    }

    li {
      @extend %navigation-list-item;

      &.menu {
        > a {
          &:after {
            @extend %pull-right;
            margin-left: 0.5em;
            content: "\f0d7";
            font-family: FontAwesome;
            font-weight: normal;
            font-style: normal;
            text-decoration: inherit;
            -webkit-font-smoothing: antialiased;
          }
        }
        &.on {
          > a {
            @extend %navigation-link-active;
          }
        }
      }

      ul {
        @extend %navigation-menu;

        a {
          @extend %block, %align-left;
          border-top: $border-thickness $border-style $nav-border-color;
        }

        li:first-child {
          a {
            border-top: none;
          }
        }
      }

      li {
        float: none;
        &:last-child {
          a {
            @include rounded(0 0 $default-radius $default-radius);
          }
        }

        &.menu {
          > a {
            &:after {
              content: "\f0da";
            }
          }
        }

        ul {
          top: 0;
          left: 100%;
          min-width: none;
          font-size: 1em;
          @include rounded(0 $default-radius $default-radius $default-radius);

          li {
            &:first-child {
              a {
                @include rounded(0 $default-radius 0 0);
              }
            }
            &:last-child {
              a {
                @include rounded(0 0 $default-radius $default-radius);
              }
            }
          }
        }
      }

      // &:hover, &:focus {
      //   > ul {
      //     display: block;
      //   }
      // }

      > ul.open {
        display: block;
      }
    }

    a, a:visited {
      @extend %navigation-link;
      @for $i from 1 through length($navigation-states) {
        &.#{nth($navigation-states, $i)} {
          @extend %navigation-link-#{nth($navigation-states, $i)};
        }
      }
    }
  }
}

@if $aria-selectors {
  [role~=navigation] {
    @extend %navigation;
  }
}
